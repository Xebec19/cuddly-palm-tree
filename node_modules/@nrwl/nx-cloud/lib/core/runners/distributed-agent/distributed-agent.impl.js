const a5_0x89d6=['DistributedAgentApi','done','Executing:\x20\x27','SIGINT','completeRunGroupWithError','/tasks-hashes-','submitRunMetrics','output','.lock','toString','default','retryDuring:\x20','existsSync','floor','params','length','message','readFileSync','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','VERBOSE_LOGGING','parse','exit','error:\x20','true','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','apply','executionId','reset','unlinkSync','tasksRunnerOptions','tasks','__awaiter','projects','note','strip-json-comments','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','completed:\x20','CIRCLECI','criticalErrorMessage','catch','Waiting...','../../../utilities/environment','CIRCLE_STAGE','completedTasks','Duplicate\x20Agent\x20ID\x20Detected','Fetching\x20tasks...','next','configuration','../../../utilities/metric-logger','executionId:\x20','retryDuring','then','startAgent','value','maxParallel:\x20','--configuration=','completedStatusCode','projectName','maxParallel','wait','\x20--projects=','/lockfiles','forEach','getRunGroup','./node_modules/.cache/nx','getTime','env','NX_AGENT_NAME','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','createNoNewMessagesTimeout','includes','__esModule','defineProperty','target','nx.json','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','Command\x20execution\x20failed\x20(distributed\x20task\x20execution:\x20','Waiter','error','push','cacheDirectory','child_process','options','inherit','Other\x20Nx\x20Cloud\x20Agents\x20Detected','random','npx\x20nx\x20run-many\x20--target=','taskId','../../../utilities/create-no-new-messages-timeout','Distributed\x20Execution\x20Terminated','Critical\x20Error\x20in\x20Agent:\x20\x22','mkdirSync','API\x20Response','@nrwl/workspace/src/utilities/output','completed','Agent\x20','join'];(function(_0x377501,_0x89d67c){const _0x5cc7fd=function(_0x2971d7){while(--_0x2971d7){_0x377501['push'](_0x377501['shift']());}};_0x5cc7fd(++_0x89d67c);}(a5_0x89d6,0x14d));const a5_0x5cc7=function(_0x377501,_0x89d67c){_0x377501=_0x377501-0x0;let _0x5cc7fd=a5_0x89d6[_0x377501];return _0x5cc7fd;};'use strict';var __awaiter=this&&this[a5_0x5cc7('0x56')]||function(_0x400c4d,_0x3919a1,_0x2d94db,_0x3d1342){function _0x44328c(_0x51a10c){return _0x51a10c instanceof _0x2d94db?_0x51a10c:new _0x2d94db(function(_0x2401e2){_0x2401e2(_0x51a10c);});}return new(_0x2d94db||(_0x2d94db=Promise))(function(_0x4fab6c,_0x3d6d30){function _0x26acbf(_0x44512f){try{_0x404029(_0x3d1342[a5_0x5cc7('0x4')](_0x44512f));}catch(_0x2edd57){_0x3d6d30(_0x2edd57);}}function _0x360692(_0x1b8ca3){try{_0x404029(_0x3d1342['throw'](_0x1b8ca3));}catch(_0xe91521){_0x3d6d30(_0xe91521);}}function _0x404029(_0x5e7dfe){_0x5e7dfe[a5_0x5cc7('0x38')]?_0x4fab6c(_0x5e7dfe['value']):_0x44328c(_0x5e7dfe[a5_0x5cc7('0xb')])[a5_0x5cc7('0x9')](_0x26acbf,_0x360692);}_0x404029((_0x3d1342=_0x3d1342[a5_0x5cc7('0x50')](_0x400c4d,_0x3919a1||[]))[a5_0x5cc7('0x4')]());});};Object[a5_0x5cc7('0x1e')](exports,a5_0x5cc7('0x1d'),{'value':!![]});exports[a5_0x5cc7('0xa')]=void 0x0;const output_1=require(a5_0x5cc7('0x33'));const child_process_1=require(a5_0x5cc7('0x27'));const stripJsonComments=require(a5_0x5cc7('0x59'));const distributed_agent_api_1=require('./distributed-agent.api');const waiter_1=require('../../../utilities/waiter');const environment_1=require(a5_0x5cc7('0x60'));const print_run_group_error_1=require('../../error/print-run-group-error');const create_no_new_messages_timeout_1=require(a5_0x5cc7('0x2e'));const fs_1=require('fs');const metric_logger_1=require(a5_0x5cc7('0x6'));function executeTasks(_0x2d3196,_0x13d902){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x2eb68e=0x0;let _0x2910e2=null;const _0x2922ae=(0x0,create_no_new_messages_timeout_1[a5_0x5cc7('0x1b')])();const _0x2cd994=new waiter_1[(a5_0x5cc7('0x23'))]();let _0x3745e9=[];const _0x616f70=new Date();let _0x12bd33=![];while(!![]){if(environment_1['VERBOSE_LOGGING']){output_1['output'][a5_0x5cc7('0x58')]({'title':a5_0x5cc7('0x3')});}_0x2910e2=yield _0x13d902['tasks'](_0x2910e2?_0x2910e2[a5_0x5cc7('0x51')]:null,_0x2eb68e,_0x3745e9);if(environment_1[a5_0x5cc7('0x4a')]){output_1['output'][a5_0x5cc7('0x58')]({'title':a5_0x5cc7('0x32'),'bodyLines':[a5_0x5cc7('0x5b')+_0x2910e2[a5_0x5cc7('0x34')],a5_0x5cc7('0x42')+_0x2910e2[a5_0x5cc7('0x8')],a5_0x5cc7('0x7')+_0x2910e2['executionId'],'number\x20of\x20tasks:\x20'+_0x2910e2[a5_0x5cc7('0x55')][a5_0x5cc7('0x46')],a5_0x5cc7('0x4d')+_0x2910e2['criticalErrorMessage'],a5_0x5cc7('0xc')+_0x2910e2[a5_0x5cc7('0x10')]]});}if(_0x2910e2['criticalErrorMessage']){output_1[a5_0x5cc7('0x3e')][a5_0x5cc7('0x24')]({'title':a5_0x5cc7('0x2f'),'bodyLines':['Error:',_0x2910e2[a5_0x5cc7('0x5d')]]});process[a5_0x5cc7('0x4c')](0x0);}if((_0x2910e2===null||_0x2910e2===void 0x0?void 0x0:_0x2910e2['retryDuring'])&&(_0x2910e2===null||_0x2910e2===void 0x0?void 0x0:_0x2910e2[a5_0x5cc7('0x8')])!==0x0&&!_0x12bd33&&new Date()['getTime']()-_0x616f70[a5_0x5cc7('0x17')]()>_0x2910e2[a5_0x5cc7('0x8')]){yield _0x2cd994[a5_0x5cc7('0x11')]();continue;}if(_0x2910e2['completed'])return;_0x2922ae(_0x2910e2[a5_0x5cc7('0x55')]['map'](_0x3598be=>_0x3598be[a5_0x5cc7('0x2d')])[a5_0x5cc7('0x36')](''));if(!_0x2910e2[a5_0x5cc7('0x51')]){if(environment_1[a5_0x5cc7('0x4a')]){output_1[a5_0x5cc7('0x3e')][a5_0x5cc7('0x58')]({'title':a5_0x5cc7('0x5f')});}yield _0x2cd994[a5_0x5cc7('0x11')]();_0x2eb68e=0x0;_0x3745e9=[];continue;}_0x2cd994[a5_0x5cc7('0x52')]();_0x12bd33=!![];const _0x2fd694=invokeTasksUsingRunMany(_0x2d3196,_0x2910e2[a5_0x5cc7('0x51')],_0x2910e2[a5_0x5cc7('0x55')],_0x2910e2[a5_0x5cc7('0x10')]);_0x2eb68e=_0x2fd694[a5_0x5cc7('0xe')];_0x3745e9=_0x2fd694[a5_0x5cc7('0x1')];}});}function readCompletedTasks(_0x5e6f33,_0x16d523){const _0x2f8dd8=a5_0x5cc7('0x22')+_0x16d523+').\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.';let _0x7ab40e;try{const _0xf2c8d9=_0x5e6f33[a5_0x5cc7('0x26')]||a5_0x5cc7('0x16');const _0x16d8d0=_0xf2c8d9+a5_0x5cc7('0x3c')+_0x16d523;_0x7ab40e=JSON['parse']((0x0,fs_1[a5_0x5cc7('0x48')])(_0x16d8d0)[a5_0x5cc7('0x40')]());(0x0,fs_1['unlinkSync'])(_0x16d8d0);}catch(_0x352010){throw new Error(_0x2f8dd8);}if(_0x7ab40e[a5_0x5cc7('0x46')]==0x0){throw new Error(_0x2f8dd8);}return _0x7ab40e;}function invokeTasksUsingRunMany(_0x318071,_0x36ffcb,_0x37a0b0,_0x2e24b2){let _0x1f86eb=0x0;const _0xdf54f5=[];for(const _0x3fe72a of groupByTarget(_0x37a0b0)){const _0x5cb73d=_0x3fe72a[a5_0x5cc7('0x5')]?a5_0x5cc7('0xd')+_0x3fe72a[a5_0x5cc7('0x5')]:'';const _0xa8503c=_0x2e24b2>0x1?'\x20--parallel\x20--max-parallel='+_0x2e24b2:'';const _0x2eb867=a5_0x5cc7('0x2c')+_0x3fe72a[a5_0x5cc7('0x1f')]+'\x20'+_0x5cb73d+a5_0x5cc7('0x12')+_0x3fe72a[a5_0x5cc7('0x57')][a5_0x5cc7('0x36')](',')+'\x20'+_0x3fe72a[a5_0x5cc7('0x45')]+_0xa8503c;if(environment_1[a5_0x5cc7('0x4a')]){output_1['output'][a5_0x5cc7('0x58')]({'title':a5_0x5cc7('0x39')+_0x2eb867+'\x27'});}try{(0x0,child_process_1['execSync'])(_0x2eb867,{'stdio':[a5_0x5cc7('0x29'),a5_0x5cc7('0x29'),'inherit'],'env':Object['assign'](Object['assign']({},process[a5_0x5cc7('0x18')]),{'NX_CACHE_FAILURES':a5_0x5cc7('0x4e'),'NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x36ffcb})});}catch(_0x1d08ea){if(_0x1d08ea['status']===environment_1[a5_0x5cc7('0x5a')]){throw _0x1d08ea;}else{_0x1f86eb=0x1;}}finally{_0xdf54f5[a5_0x5cc7('0x25')](...readCompletedTasks(_0x318071,_0x36ffcb));}}return{'completedStatusCode':_0x1f86eb,'completedTasks':_0xdf54f5};}function groupByTarget(_0x2e2df1){const _0x4f1612=[];_0x2e2df1[a5_0x5cc7('0x14')](_0x166a1c=>{const _0x585187=_0x4f1612['find'](_0x7f6426=>_0x7f6426['target']===_0x166a1c['target']&&_0x7f6426[a5_0x5cc7('0x5')]===_0x166a1c[a5_0x5cc7('0x5')]);if(_0x585187){_0x585187['projects'][a5_0x5cc7('0x25')](_0x166a1c[a5_0x5cc7('0xf')]);}else{_0x4f1612[a5_0x5cc7('0x25')]({'target':_0x166a1c['target'],'projects':[_0x166a1c[a5_0x5cc7('0xf')]],'params':_0x166a1c[a5_0x5cc7('0x45')],'configuration':_0x166a1c[a5_0x5cc7('0x5')]});}});return _0x4f1612;}function getAgentName(){if(process[a5_0x5cc7('0x18')][a5_0x5cc7('0x19')]!==undefined){return process['env'][a5_0x5cc7('0x19')];}else if(process[a5_0x5cc7('0x18')][a5_0x5cc7('0x5c')]!==undefined){return process[a5_0x5cc7('0x18')][a5_0x5cc7('0x0')];}else{return a5_0x5cc7('0x35')+Math[a5_0x5cc7('0x44')](Math[a5_0x5cc7('0x2b')]()*0x186a0);}}function createAgentLockfile(_0x5184ac,_0x57a981){const _0x1e895b=_0x5184ac[a5_0x5cc7('0x26')]||a5_0x5cc7('0x16');const _0x41e91a=_0x1e895b+a5_0x5cc7('0x13');const _0x2186ea=_0x41e91a+'/'+_0x57a981+a5_0x5cc7('0x3f');if(!(0x0,fs_1['existsSync'])(_0x41e91a)){(0x0,fs_1[a5_0x5cc7('0x31')])(_0x41e91a,{'recursive':!![]});}const _0x4bdaad=(0x0,fs_1['readdirSync'])(_0x41e91a);if(_0x4bdaad['length']){if(_0x4bdaad[a5_0x5cc7('0x1c')](_0x57a981+a5_0x5cc7('0x3f'))){output_1['output'][a5_0x5cc7('0x24')]({'title':a5_0x5cc7('0x2'),'bodyLines':[a5_0x5cc7('0x1a'),'',a5_0x5cc7('0x49')]});process[a5_0x5cc7('0x4c')](0x1);}output_1[a5_0x5cc7('0x3e')]['warn']({'title':a5_0x5cc7('0x2a'),'bodyLines':[a5_0x5cc7('0x4f'),'','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.']});}(0x0,fs_1['writeFileSync'])(_0x2186ea,'');process['on']('exit',()=>cleanupAgentLockfile(_0x2186ea));process['on'](a5_0x5cc7('0x3a'),()=>cleanupAgentLockfile(_0x2186ea));}function cleanupAgentLockfile(_0x267a2f){if((0x0,fs_1[a5_0x5cc7('0x43')])(_0x267a2f)){(0x0,fs_1[a5_0x5cc7('0x53')])(_0x267a2f);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2556ac=(0x0,environment_1[a5_0x5cc7('0x15')])();if(!_0x2556ac){(0x0,print_run_group_error_1['printRunGroupError'])();return process[a5_0x5cc7('0x4c')](0x1);}output_1[a5_0x5cc7('0x3e')][a5_0x5cc7('0x58')]({'title':a5_0x5cc7('0x21')});const _0x2df447=JSON[a5_0x5cc7('0x4b')](stripJsonComments((0x0,fs_1['readFileSync'])(a5_0x5cc7('0x20'))[a5_0x5cc7('0x40')]()))[a5_0x5cc7('0x54')][a5_0x5cc7('0x41')][a5_0x5cc7('0x28')];const _0x437b23=getAgentName();createAgentLockfile(_0x2df447,_0x437b23);const _0x38744d=new distributed_agent_api_1[(a5_0x5cc7('0x37'))](_0x2df447,_0x2556ac,_0x437b23);return executeTasks(_0x2df447,_0x38744d)['then'](_0x2e165f=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1[a5_0x5cc7('0x3d')])(_0x2df447);return _0x2e165f;}))[a5_0x5cc7('0x5e')](_0x1cf2f4=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x38744d[a5_0x5cc7('0x3b')](a5_0x5cc7('0x30')+_0x1cf2f4[a5_0x5cc7('0x47')]+'\x22');throw _0x1cf2f4;}));});}exports[a5_0x5cc7('0xa')]=startAgent;