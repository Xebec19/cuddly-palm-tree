const a1_0x3bfd=['../../../utilities/environment','value','./cloud-run.api','lifeCycle','CloudRemoteCache','waitForStoreRequestsToComplete','parseCommand','MessageReporter','filter','EndOfRunMessage','../../../utilities/metric-logger','../../file-storage/e2e-encryption','throw','env','note','all','../../terminal-output/end-of-run-message','getMachineInfo','error','path','output','Executed\x20tasks\x20with\x20hashes:\x20','../../file-storage/file-storage','cloudEnabledTasksRunner','__awaiter','@nrwl/workspace/src/tasks-runner/life-cycle','startRun','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','writeFileSync','getBranch','anyErrors','then','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','catch','cacheableOperations','join','../../terminal-output/output-obfuscator','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','CloudEnabledLifeCycle','extractGitSha','@nrwl/workspace/src/tasks-runner/tasks-runner-v2','./node_modules/.cache/nx','__esModule','assign','printMessages','encryptionKey','exit','scan','submitRunMetrics','@nrwl/workspace/src/utilities/output','next','hash','OutputObfuscator','printCacheHitsMessage','Agent\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run','obfuscate','getRunGroup','VERBOSE_LOGGING','map','ENCRYPTION_KEY','cacheDirectory','E2EEncryption','../../terminal-output/message-reporter','subscribe','tasksRunnerV2'];(function(_0x1968f8,_0x3bfd8f){const _0xa5bdf2=function(_0x31a077){while(--_0x31a077){_0x1968f8['push'](_0x1968f8['shift']());}};_0xa5bdf2(++_0x3bfd8f);}(a1_0x3bfd,0xce));const a1_0xa5bd=function(_0x1968f8,_0x3bfd8f){_0x1968f8=_0x1968f8-0x0;let _0xa5bdf2=a1_0x3bfd[_0x1968f8];return _0xa5bdf2;};'use strict';var __awaiter=this&&this[a1_0xa5bd('0xd')]||function(_0x581805,_0x4fe97e,_0x3a42cd,_0xcf4725){function _0x283478(_0x481b63){return _0x481b63 instanceof _0x3a42cd?_0x481b63:new _0x3a42cd(function(_0x2064da){_0x2064da(_0x481b63);});}return new(_0x3a42cd||(_0x3a42cd=Promise))(function(_0xdc4f17,_0x14dd51){function _0x18db6b(_0x21c16e){try{_0x53f58b(_0xcf4725[a1_0xa5bd('0x27')](_0x21c16e));}catch(_0x3f34a0){_0x14dd51(_0x3f34a0);}}function _0x32ba95(_0x4e8c46){try{_0x53f58b(_0xcf4725[a1_0xa5bd('0x1')](_0x4e8c46));}catch(_0x523f21){_0x14dd51(_0x523f21);}}function _0x53f58b(_0x6f54c){_0x6f54c['done']?_0xdc4f17(_0x6f54c[a1_0xa5bd('0x37')]):_0x283478(_0x6f54c[a1_0xa5bd('0x37')])[a1_0xa5bd('0x14')](_0x18db6b,_0x32ba95);}_0x53f58b((_0xcf4725=_0xcf4725['apply'](_0x581805,_0x4fe97e||[]))[a1_0xa5bd('0x27')]());});};Object['defineProperty'](exports,a1_0xa5bd('0x1f'),{'value':!![]});exports['cloudEnabledTasksRunner']=void 0x0;const Subject_1=require('rxjs/internal/Subject');const message_reporter_1=require(a1_0xa5bd('0x33'));const end_of_run_message_1=require(a1_0xa5bd('0x5'));const output_obfuscator_1=require(a1_0xa5bd('0x19'));const cloud_enabled_life_cycle_1=require('./cloud-enabled-life-cycle');const file_storage_1=require(a1_0xa5bd('0xb'));const e2e_encryption_1=require(a1_0xa5bd('0x0'));const environment_1=require(a1_0xa5bd('0x36'));const cloud_remote_cache_1=require('./cloud-remote-cache');const tasks_runner_v2_1=require(a1_0xa5bd('0x1d'));const output_1=require(a1_0xa5bd('0x26'));const cloud_run_api_1=require(a1_0xa5bd('0x38'));const fs_1=require('fs');const path=require(a1_0xa5bd('0x8'));const metric_logger_1=require(a1_0xa5bd('0x40'));function createApi(_0x3efe62,_0x4150b9,_0x4f3cf2){const _0x359bcb=(0x0,environment_1[a1_0xa5bd('0x6')])(_0x4150b9);return new cloud_run_api_1['CloudRunApi'](_0x3efe62,_0x4f3cf2,_0x4150b9,_0x359bcb);}function storeTaskHashes(_0x492713,_0x3fd681,_0xc26fd3){const _0x5b5aa6=JSON['stringify'](_0x492713[a1_0xa5bd('0x2f')](_0x370d92=>({'taskId':_0x370d92['taskId'],'hash':_0x370d92['hash']})));if(environment_1[a1_0xa5bd('0x2e')]){output_1[a1_0xa5bd('0x9')][a1_0xa5bd('0x3')]({'title':a1_0xa5bd('0xa')+_0x5b5aa6});}(0x0,fs_1[a1_0xa5bd('0x11')])(path[a1_0xa5bd('0x18')](_0x3fd681,'tasks-hashes-'+_0xc26fd3),_0x5b5aa6);}function onComplete(_0x46b26f,_0x2d693e,_0x4a90f8,_0x5e7965,_0x2b4a57,_0x436df1,_0x41c5c6,_0x33005f,_0x66129f,_0x1f9d01){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x59af2d=new Date()['toISOString']();if(environment_1['AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION']){storeTaskHashes(_0x66129f,_0x2d693e['cacheDirectory']||a1_0xa5bd('0x1e'),environment_1[a1_0xa5bd('0x15')]);}const _0x1a1dbc=(0x0,environment_1[a1_0xa5bd('0x12')])();const _0xeabfdc=yield Promise[a1_0xa5bd('0x4')]([_0x4a90f8[a1_0xa5bd('0x3b')](),_0x5e7965['endRun']({'command':_0x2b4a57[a1_0xa5bd('0x2c')]((0x0,environment_1[a1_0xa5bd('0x3c')])()),'startTime':_0x436df1,'endTime':_0x59af2d,'distributedExecutionId':environment_1[a1_0xa5bd('0x15')],'branch':_0x1a1dbc,'scan':!![],'runGroup':(0x0,environment_1[a1_0xa5bd('0x2d')])(),'sha':_0x1a1dbc?(0x0,environment_1[a1_0xa5bd('0x1c')])():undefined},_0x66129f)]);if(_0x1f9d01){setTimeout(()=>{_0x41c5c6[a1_0xa5bd('0x21')]();if(!_0x41c5c6[a1_0xa5bd('0x13')]){_0x33005f[a1_0xa5bd('0x2a')]();}},0x0);}else{_0x41c5c6[a1_0xa5bd('0x21')]();if(!_0x41c5c6[a1_0xa5bd('0x13')]){_0x33005f[a1_0xa5bd('0x2a')]();}}if(environment_1[a1_0xa5bd('0x1a')]){if(!_0xeabfdc[0x0]){output_1[a1_0xa5bd('0x9')]['error']({'title':'Agent\x20wasn\x27t\x20able\x20to\x20store\x20artifacts'});_0x41c5c6['printMessages']();process[a1_0xa5bd('0x23')](environment_1[a1_0xa5bd('0x10')]);}if(!_0xeabfdc[0x1]){output_1['output'][a1_0xa5bd('0x7')]({'title':a1_0xa5bd('0x2b')});_0x41c5c6[a1_0xa5bd('0x21')]();process[a1_0xa5bd('0x23')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}}yield(0x0,metric_logger_1[a1_0xa5bd('0x25')])(_0x2d693e);});}function createLifeCycle(_0x43850e,_0x36ad6f,_0x1b34c7,_0x4c1d10){const _0x4c5d2a=new cloud_enabled_life_cycle_1[(a1_0xa5bd('0x1b'))](_0x43850e,_0x36ad6f[a1_0xa5bd('0x31')],_0x36ad6f[a1_0xa5bd('0x24')]===undefined?!![]:_0x36ad6f[a1_0xa5bd('0x24')],_0x36ad6f[a1_0xa5bd('0x17')]||[],_0x1b34c7,_0x4c1d10);try{const {CompositeLifeCycle}=require(a1_0xa5bd('0xe'));if(!CompositeLifeCycle)return _0x4c5d2a;return new CompositeLifeCycle([_0x36ad6f[a1_0xa5bd('0x39')],_0x4c5d2a]);}catch(_0xba0be4){return _0x4c5d2a;}}function cloudEnabledTasksRunner(_0x404943,_0x342bdd,_0x224c54){const _0x3b4609={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x404943};const _0x43085a=_0x342bdd[a1_0xa5bd('0x39')]===undefined;const _0x3dc2e1=[];const _0x2ef4d5=new message_reporter_1[(a1_0xa5bd('0x3d'))](_0x342bdd);const _0x4b9b01=createApi(_0x2ef4d5,_0x342bdd,_0x3b4609);const _0x2746a9=new end_of_run_message_1[(a1_0xa5bd('0x3f'))](_0x3b4609,_0x3dc2e1);const _0x2ceacf=new output_obfuscator_1[(a1_0xa5bd('0x29'))]();const _0x3ae608=_0x404943[a1_0xa5bd('0x2f')](_0x4c6cdf=>_0x4c6cdf[a1_0xa5bd('0x28')])[a1_0xa5bd('0x3e')](_0x54292d=>!!_0x54292d);const _0x488bd7=_0x4b9b01[a1_0xa5bd('0xf')](environment_1[a1_0xa5bd('0x15')],_0x3ae608);_0x3ae608['forEach'](_0x25530e=>{_0x3b4609['requests'][_0x25530e]=_0x488bd7;});const _0x396157=new Date()['toISOString']();const _0x308838=createLifeCycle(_0x3b4609,_0x342bdd,_0x2ceacf,_0x3dc2e1);const _0x2879a2=new e2e_encryption_1[(a1_0xa5bd('0x32'))](environment_1[a1_0xa5bd('0x30')]||_0x342bdd[a1_0xa5bd('0x22')]);const _0x52453c=new file_storage_1['FileStorage'](_0x2879a2);const _0x32658d=new cloud_remote_cache_1[(a1_0xa5bd('0x3a'))](_0x2ef4d5,_0x4b9b01,_0x3b4609,_0x52453c);delete process[a1_0xa5bd('0x2')][a1_0xa5bd('0x15')];const _0x4a52fa=(0x0,tasks_runner_v2_1[a1_0xa5bd('0x35')])(_0x404943,Object[a1_0xa5bd('0x20')](Object['assign']({},_0x342bdd),{'remoteCache':_0x32658d,'lifeCycle':_0x308838}),_0x224c54);if(_0x4a52fa[a1_0xa5bd('0x34')]){const _0x35c65b=new Subject_1['Subject']();_0x4a52fa[a1_0xa5bd('0x34')]({'next':_0x3266dc=>_0x35c65b[a1_0xa5bd('0x27')](_0x3266dc),'error':_0x9d4d00=>_0x35c65b[a1_0xa5bd('0x7')](_0x9d4d00),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x308838,_0x342bdd,_0x32658d,_0x4b9b01,_0x2ceacf,_0x396157,_0x2ef4d5,_0x2746a9,_0x3dc2e1,_0x43085a);_0x35c65b['complete']();})});return _0x35c65b;}else{return _0x4a52fa[a1_0xa5bd('0x14')](_0x3466ef=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x308838,_0x342bdd,_0x32658d,_0x4b9b01,_0x2ceacf,_0x396157,_0x2ef4d5,_0x2746a9,_0x3dc2e1,_0x43085a);return _0x3466ef;}))[a1_0xa5bd('0x16')](_0x15bed6=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x308838,_0x342bdd,_0x32658d,_0x4b9b01,_0x2ceacf,_0x396157,_0x2ef4d5,_0x2746a9,_0x3dc2e1,_0x43085a);throw _0x15bed6;}));}}exports[a1_0xa5bd('0xc')]=cloudEnabledTasksRunner;